{% extends 'partials/base.html' %}
{% block content %}
<div class="text-center">
<h1>Authors</h1>

<a href="{% url 'library:add' %}?next={{ request.path }}">
    <button class="btn btn-default btn-success">Add author</button>
</a>
</div>
<hr>
<ol class="list-group text-center">
    {% for author in authors %}

    <li id={{author.id}}><a href="{% url 'library:author_details' author.id %}?next={{ request.path }}">{{author.author_name}}</a>
        <a href="{% url 'library:modify' author.id %}?next={{ request.path }}">
            <button class="btn btn-default btn-primary btn-sm">Modify</button>
        </a>
        <button class="del_a btn btn-default btn-danger btn-sm" id={{author.id}}>Delete</button>
    </li>
    {% endfor %}
</ol>

<script>

    $(document).ready(function () {
        $(".del_a").click(deleteAuthor)

        function deleteAuthor(e) {

            var id = $(this).attr('id')

            conf = confirm("Do you want to delete this author?")
            if (conf) {

                $.ajax({
                    url: '/home/author/delete/' + id + "/",
                    type: 'DELETE',
                    dataType: 'json',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
                    },
                    success: function (data) {
                        if (data.deleted) {
                            $('#'+id).remove();
                        } else {
                            alert("Error deleting author")
                        }
                    }
                });                
            } else {
                alert("Action Cancelled")
            }
        }
    })
</script> 
{% endblock %}